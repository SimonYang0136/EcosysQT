<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0" version="28.2.9">
  <diagram name="第 1 页" id="pXbu11bbhYsIhRV4pIma">
    <mxGraphModel dx="1405" dy="773" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-1" value="ThreadPool 线程池系统" style="whiteSpace=wrap;strokeWidth=2;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="20" y="20" width="2281" height="1193" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-3" value="使用模式" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="511" y="51" width="739" height="460" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-16" value="工作线程逻辑 (worker_thread)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="935" y="530" width="1316" height="651" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-17" value="" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="511" y="531" width="349" height="629" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-14" value="公共接口" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="46" y="79" width="391" height="1081" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-2" value="EcosystemState中的使用&#xa;├─ dispatch_decision_tasks()&#xa;│   └─ 提交动物/植物决策任务&#xa;├─ dispatch_map_update_tasks()&#xa;│   └─ 提交地图更新任务&#xa;└─ wait_for_all_tasks()&#xa;    └─ 等待阶段完成" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="549" y="102" width="274" height="246" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-4" value="m_workers: vector&amp;lt;thread&amp;gt;&#xa;工作线程数组" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="556" y="1062" width="258" height="78" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-5" value="线程主循环&#xa;while (!m_stop)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="972" y="1062" width="173" height="78" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-6" value="m_task_queue: queue&amp;lt;function&amp;lt;void()&amp;gt;&amp;gt;&#xa;任务队列 (FIFO)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="555" y="566" width="260" height="102" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-7" value="等待任务&#xa;m_condition.wait(lock,&#xa;  []{return !m_task_queue.empty() || m_stop})&#xa;阻塞直到有任务或停止信号" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="1220" y="678" width="260" height="174" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-8" value="同步原语&#xa;├─ m_queue_mutex: mutex&#xa;├─ m_condition: condition_variable&#xa;├─ m_pending_tasks: atomic&amp;lt;size_t&amp;gt;&#xa;├─ m_stop: atomic&amp;lt;bool&amp;gt;&#xa;└─ m_completion_condition: condition_variable" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="555" y="718" width="260" height="294" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-9" value="执行任务&#xa;├─ task = m_task_queue.front()&#xa;├─ m_task_queue.pop()&#xa;├─ unlock mutex&#xa;├─ task() 执行函数&#xa;└─ --m_pending_tasks" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="1555" y="666" width="260" height="198" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-10" value="通知完成&#xa;m_completion_condition.notify_all()&#xa;唤醒等待完成的主线程" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="1890" y="832" width="323" height="102" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-11" value="submit(task)&#xa;├─ lock_guard&amp;lt;mutex&amp;gt; lock(m_queue_mutex)&#xa;├─ m_task_queue.push(task)&#xa;├─ ++m_pending_tasks&#xa;└─ m_condition.notify_one()" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="111" y="114" width="260" height="222" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-12" value="submit_batch(tasks)&#xa;├─ 批量提交任务&#xa;├─ 减少锁竞争&#xa;└─ 提高并发效率" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="138" y="658" width="205" height="126" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-13" value="wait_for_all_tasks()&#xa;├─ unique_lock&amp;lt;mutex&amp;gt; lock(m_mutex)&#xa;├─ m_completion_condition.wait(lock,&#xa;│    []{return m_pending_tasks == 0})&#xa;└─ 阻塞直到所有任务完成" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="83" y="386" width="316" height="222" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-15" value="get_current_worker_id()&#xa;├─ thread_local static size_t id&#xa;├─ 返回当前线程索引&#xa;└─ 用于线程本地存储" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="111" y="834" width="260" height="150" as="geometry" />
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-18" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="d7aiB6STB_uyd1m0Ol7r-1" source="d7aiB6STB_uyd1m0Ol7r-4" target="d7aiB6STB_uyd1m0Ol7r-5">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-19" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0.12;entryY=0;rounded=0;" edge="1" parent="d7aiB6STB_uyd1m0Ol7r-1" source="d7aiB6STB_uyd1m0Ol7r-6" target="d7aiB6STB_uyd1m0Ol7r-7">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1183" y="617" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-20" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.95;rounded=0;" edge="1" parent="d7aiB6STB_uyd1m0Ol7r-1" source="d7aiB6STB_uyd1m0Ol7r-8" target="d7aiB6STB_uyd1m0Ol7r-7">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1183" y="865" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-21" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.76;exitY=0;entryX=0.26;entryY=1;rounded=0;" edge="1" parent="d7aiB6STB_uyd1m0Ol7r-1" source="d7aiB6STB_uyd1m0Ol7r-5" target="d7aiB6STB_uyd1m0Ol7r-7">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1183" y="993" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-22" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="d7aiB6STB_uyd1m0Ol7r-1" source="d7aiB6STB_uyd1m0Ol7r-7" target="d7aiB6STB_uyd1m0Ol7r-9">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-23" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0.23;entryY=0;rounded=0;" edge="1" parent="d7aiB6STB_uyd1m0Ol7r-1" source="d7aiB6STB_uyd1m0Ol7r-9" target="d7aiB6STB_uyd1m0Ol7r-10">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1853" y="765" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-24" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.37;exitY=1;entryX=1;entryY=0.74;rounded=0;" edge="1" parent="d7aiB6STB_uyd1m0Ol7r-1" source="d7aiB6STB_uyd1m0Ol7r-10" target="d7aiB6STB_uyd1m0Ol7r-5">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1853" y="1128" />
              <mxPoint x="1183" y="1128" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-25" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.73;exitY=1;entryX=0;entryY=0.33;rounded=0;" edge="1" parent="d7aiB6STB_uyd1m0Ol7r-1" source="d7aiB6STB_uyd1m0Ol7r-11" target="d7aiB6STB_uyd1m0Ol7r-6">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="436" y="594" />
              <mxPoint x="511" y="594" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-26" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.27;entryX=0;entryY=0.86;rounded=0;" edge="1" parent="d7aiB6STB_uyd1m0Ol7r-1" source="d7aiB6STB_uyd1m0Ol7r-12" target="d7aiB6STB_uyd1m0Ol7r-6">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="436" y="666" />
              <mxPoint x="511" y="666" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-27" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.69;exitY=1;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="d7aiB6STB_uyd1m0Ol7r-1" source="d7aiB6STB_uyd1m0Ol7r-13" target="d7aiB6STB_uyd1m0Ol7r-8">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="436" y="865" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-28" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.35;entryX=0;entryY=0.34;rounded=0;" edge="1" parent="d7aiB6STB_uyd1m0Ol7r-1" source="d7aiB6STB_uyd1m0Ol7r-11" target="d7aiB6STB_uyd1m0Ol7r-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="436" y="176" />
              <mxPoint x="511" y="176" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-29" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.23;entryX=0.1;entryY=1;rounded=0;" edge="1" parent="d7aiB6STB_uyd1m0Ol7r-1" source="d7aiB6STB_uyd1m0Ol7r-13" target="d7aiB6STB_uyd1m0Ol7r-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="436" y="422" />
              <mxPoint x="511" y="422" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="d7aiB6STB_uyd1m0Ol7r-30" value="核心组件" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="d7aiB6STB_uyd1m0Ol7r-1">
          <mxGeometry x="620" y="984" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
